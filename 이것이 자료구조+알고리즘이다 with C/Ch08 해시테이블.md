# Ch08 해시 테이블

# 해시 테이블의 개요

## 해시

- 데이터를 입력 받아 완전히 다른 모습의 데이터로 바꾸는 작업
- 사용처
  - 해시 테이블
    - 데이터의 해시값을 테이블 내 주소로 사용하는 탐색 알고리즘
  - 암호화
    - 해싱은 원본 데이터를 다른 모습으로 바꾸는데, 일정하게 변화하므로 마치 지문과 같은 역할을 한다.
    - 그래서 디지털 서명이나 블록체인에서 많이 사용한다.
  - 데이터 축약
    - 길이가 서로 다른 입력 데이터에 대해 일정한 길이의 출력을 만들 수 있다.
    - 이것을 이용해 거대한 데이터를 해싱해서 짧은 길이로 축약한다.

## 해시 테이블

- 데이터의 탐색을 빨리 하기 위해서 데이터의 해시값을 테이블 내의 주소로 사용하는 테이블
- 데이터를 담을 테이블을 미리 크게 확보하고 입력 받은 데이터를 해싱하여 테이블 내 주소를 계산하고 이 주소에 데이터를 담는 것
- 해시 테이블은 탐색이라는 단어가 무색할 정도로 배열과 다름없는 접근 속도를 보여줌

# 해시 함수

- 입력값에서 테이블 내의 주소를 계산하는 함수
- 테이블의 크기는 소수로 정하는 것이 좋다. 특히 2의 제곱수와 거리가 먼 소수를 사용하는 것이 해시 함수가 좋은 성능을 낸다.
  - 예시: 53, 97, 193, 389, 769, 1543, 3079, 6151, 12289, 24593 등등..

## 나눗셈법

- 주소=입력값%테이블의 크기
- 나눗셈 법은 충돌 또는 클러스터가 발생할 확률이 높다.
  - 충돌
    - 서로 다른 입력값에 대해서 동일한 해시값, 해시 테이블 내의 동일한 주소를 반환하는 것
  - 클러스터
    - 똑같은 해시값이 아니더라도 해시 테이블 내 일부 주소들을 집중적으로 반환해서 한 곳에 데이터가 모이는 것

## 자릿수 접기

- 나눗셈 법의 단점을 해소하기 위해서 나온 해싱 방법
- 숫자의 각 자릿수를 더해 해시값을 만드는 방법
- 예시: 8 1 2 9 3 3 5
  - 각 자리 수를 모두 더하면 31
  - 두 자리씩 더하면 148
- 문자열을 키로 사용하는 해시 테이블에 잘 어울리는 알고리즘
  - 문자열은 ASCII 코드를 사용하기 때문에, 이를 더해서 해시값을 만들면 되기 때문이다.

## 해시 함수의 한계: 충돌

- 아무리 좋은 해싱 방법을 가지고 와도 충돌이 발생한다.

# 충돌 해결 기법

- 개방 해싱
  - 해시 테이블의 주소 바깥에 새로운 공간을 할당하는 것
- 폐쇄 해싱
  - 처음에 주어진 해시 테이블 내에서 문제를 해결하는 것

## 체이닝

- 해싱을 해서 얻은 배열의 주소 값을 포인터로 사용하는 링크드 리스트를 구현한다.
- 그래서 충돌을 일어난 경우 링크드 리스트에 추가한다.
- 다른 방법과의 차이는 삽입 연산에서는 앞으로 발생할 충돌을, 삭제 및 탐색 연산에서는 이미 발생한 충돌을 고려

### 탐색 연산

1. 찾고자 하는 목표값을 해싱하여 링크드 리스트가 저장된 주소를 찾는다.
2. 이 주소를 이용하여 해시 테이블에 저장된 링크드 리스트에 대한 포인터를 생성
3. 링크드 리스트의 앞에서부터 뒤까지 순차 탐색하여 목표값과 같은 값을 가지고 있는 노드가 있으면 해당 노드의 주소를 반환

### 삽입 연산

1. 해시 함수를 이용하여 데이터가 삽입될 링크드 리스트의 주소를 찾는다.
2. 링크드 리스트가 비어있으면 그냥 삽입한다.
3. 그렇지 않으면 헤드 앞에 삽입한다.
   1. 테일로 만들면 충돌이 일어나서 삽입할 때마다 순차 탐색을 해서 테일에 삽입해야 하므로 헤드에 삽입

### 체이닝의 성능 향상 방법

- 링크드 리스트의 단점을 물려받는 것보단, 이진 탐색 트리나 레드 블랙 트리를 이용해서 구현하는 것이 더 좋을 수 있다.

## 개방 주소법

- 충돌이 일어날 때 해시 함수에 의해 만들어진 주소가 아니더라도 다른 주소를 사용할 수 있도록 허용하는 충돌 해결 알고리즘
- 충돌이 일어나면 해시 테이블 내의 다른 주소를 탐사하여 데이터 입력

### 선형 탐사

- 충돌이 일어난 주소에서 고정 폭(예를 들면1)으로 주소를 이동
- 클러스터가 많이 발생
  - 새로운 주소를 찾기 위해 선형 탐사의 시간이 길어져서 해시 테이블의 성능이 저하

### 제곱 탐사

- 선형 탐사에서 폭이 제곱으로 변환
- 클러스터가 선형 탐사에 비해 덜 생기지만, 그래도 생김
- 규칙성을 없애는 것만이 방법임

### 이중 해싱

- 규칙성을 없애기 위해서 충돌이 발생한 경우 이동 폭을 해시 함수로 한 번 더 계산한 값으로 정한다.
- 2차 클러스터를 효과적으로 방지하여 해시 테이블의 성능 유지를 돕는다.

### 재해싱

- 결국 해시 테이블이 거의 다 차면 성능 저하를 막을 방법이 없다.
- 그래서 해시 테이블의 임계치가 차면 공간을 늘리고 모든 데이터를 재해싱해서 다시 입력한다.

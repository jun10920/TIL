# Section05\_연관관계 매핑 기초

- 테이블은 외래 키로 조인을 사용해서 연관된 테이블을 검색
- 객체는 참조를 사용해서 연관된 객체를 검색

## 단방향 연관관계

- 객체 지향적으로(객체의 연관관계를 이용해서) 테이블을 검색한다.
- 객체의 참조와 테이블의 외래 키 매핑

- 연관관계 저장
- 참조로 연관관계 조회 - 객체 그래프 탐색

**객체와 테이블이 관계를 맺는 차이**

- 객체 연관관계 = 2개
  - 회원 → 팀
  - 팀 → 회원
- 테이블 연관관계 = 1개
  - 회원 <> 팀

객체는 사실 양방향 관계가 아니라 서로 다른 단뱡항 관계 2개다

→ 그래서 객체 중 하나로 외래 키를 관리해야 한다.

### 연관관계의 주인

- 양방향 매핑 규칙
  - 객체의 두 관계 중 하나를 연관관계의 주인으로 지정
    - **외래 키가 있는 곳을 주인**
  - 연관관계의 주인만이 외래 키를 관리(등록, 수정)
  - 주인이 아닌 쪽은 읽기만 가능
    - mappedBy 속성으로 주인 지정

### 양방향 매핑시 가장 많이 하는 실수

- 연관관계의 주인에 값을 입력하지 않음

- 양방향 매핑시 연관관계의 주인에 값을 입력해야 한다.

  - 순수한 객체 관계를 고려하면 항상 양쪽 다 입력해야 한다.

- 순수 객체 상태를 고려해서 항상 양쪽에 값을 설정
  - 연관관계 편의 메서드를 생성
    - 연관관계를 맺는 메서드에 반대 방향도 연결하는 코드가 같이 있는 메서드
- 양방향 매핑 시에 무한 루프를 조심
  - toString(), lombok, JSON 생성 라이브러리

### 정리

- 단방향 매핑만으로도 이미 연관관계 매핑은 완료(JPA 상에서는)
- 양방향 매핑은 반대 방향으로 조회(객체 그래프 탐색) 기능이 추가된 것
- JPQL에서 역방향으로 탐색할 일이 많음
- 코드를 작성할 때는 단방향 매핑으로 작성하고 이후에 양방향은 필요할 때만 추가하면 된다.
  - 테이블에 영향을 주지 않기 때문
